{% extends "layouts/admin.html" %}

{% block title %} Admin {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

<!-- [ Main Content ] start -->
{% block content %}

<!-- [ Main Content ] start -->
<div class="pcoded-main-container">
    <div class="pcoded-wrapper">
        <div class="pcoded-content">
        <!-- [ breadcrumb ] start -->
        <div class="card ms-0 mb-2 p-2">
            <div class="row ms-0">
            <ul class="col breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/admin"><i class="feather icon-home"></i></a></li>
                {% block breadcrumb %}{% endblock breadcrumb %}
            </ul>
            <div class="col text-end">
                <a href="/docs/plugins/{{ request.path.split("/")[-1]}}.html" target="_blank"><i class="fas fa-info-circle"></i> {{ _('Help')}}</a>
            </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        {% block module %}

        {% endblock %}
        </div>
    </div>
</div>
{% endblock %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
    // Используем централизованный менеджер уведомлений
    // Функции-обертки для обратной совместимости
    function refreshNotifyBlock(source) {
        if (typeof NotificationSystem !== 'undefined' && NotificationSystem.isInitialized) {
            NotificationSystem.refreshNotifyBlock(source);
        }
    }
    
    function readNotify(id) {
        if (typeof NotificationSystem !== 'undefined' && NotificationSystem.isInitialized) {
            NotificationSystem.readNotify(id);
        }
    }
    
    function readNotifyAll(source) {
        if (typeof NotificationSystem !== 'undefined' && NotificationSystem.isInitialized) {
            NotificationSystem.readNotifyAll(source);
        }
    }
    
    // Делаем функции глобально доступными для обратной совместимости
    window.refreshNotifyBlock = refreshNotifyBlock;
    window.readNotify = readNotify;
    window.readNotifyAll = readNotifyAll;
    
    // Инициализация обновления блока уведомлений при загрузке страницы
    $(document).ready(function() {
        // Ждем инициализации NotificationSystem
        function tryRefresh() {
            if (typeof NotificationSystem !== 'undefined' && NotificationSystem.isInitialized) {
                const source = NotificationSystem.getCurrentSource();
                if (source) {
                    // Небольшая задержка для гарантии полной загрузки страницы
                    setTimeout(function() {
                        NotificationSystem.refreshNotifyBlock(source, true);
                    }, 300);
                }
            } else {
                setTimeout(tryRefresh, 100);
            }
        }
        
        // Пробуем сразу, если не готово - ждем
        tryRefresh();
    });
</script>
{% endblock javascripts %}